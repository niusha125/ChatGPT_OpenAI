import { asNew, intercept, mark } from "../helpers/index.js";
export default timed;

function timed(promise, create) {
  const p = asNew(promise, create);
  if (mark.get(p, 'timed')) return p;
  mark.set(p, 'timed');
  p.time = null;
  const init = Date.now();
  return intercept(p, px => {
    return px.then(val => {
      p.time = Date.now() - init;
      return val;
    }).catch(err => {
      p.time = Date.now() - init;
      return Promise.reject(err);
    });
  });
}
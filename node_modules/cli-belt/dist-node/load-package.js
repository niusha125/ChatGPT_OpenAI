"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = loadPackage;

var _findUp = _interopRequireDefault(require("find-up"));

var _fsExtra = _interopRequireDefault(require("fs-extra"));

var _normalizePackageData = _interopRequireDefault(require("normalize-package-data"));

var _errorish = require("errorish");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * It will find and return the contents of the first `package.json` found, recursing up, starting on `dir`. It can optionally normalize the data and set the `process.title` to the package name.
 */
async function loadPackage(dir, options) {
  const opts = Object.assign({
    normalize: true,
    title: false
  }, options);
  const path = await (0, _findUp.default)('package.json', {
    cwd: dir,
    type: 'file'
  });
  if (!path) throw Error(`package couldn't be found`);
  const pkg = await _fsExtra.default.readJSON(path).catch(_errorish.rejects);
  if (opts.normalize) (0, _normalizePackageData.default)(pkg);
  if (opts.title && pkg.name && pkg.name.length) process.title = pkg.name;
  return pkg;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9sb2FkLXBhY2thZ2UudHMiXSwibmFtZXMiOlsibG9hZFBhY2thZ2UiLCJkaXIiLCJvcHRpb25zIiwib3B0cyIsIk9iamVjdCIsImFzc2lnbiIsIm5vcm1hbGl6ZSIsInRpdGxlIiwicGF0aCIsImN3ZCIsInR5cGUiLCJFcnJvciIsInBrZyIsImZzIiwicmVhZEpTT04iLCJjYXRjaCIsInJlamVjdHMiLCJuYW1lIiwibGVuZ3RoIiwicHJvY2VzcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBYUE7OztBQUdlLGVBQWVBLFdBQWYsQ0FDYkMsR0FEYSxFQUViQyxPQUZhLEVBR0s7QUFDbEIsUUFBTUMsSUFBSSxHQUFHQyxNQUFNLENBQUNDLE1BQVAsQ0FBYztBQUFFQyxJQUFBQSxTQUFTLEVBQUUsSUFBYjtBQUFtQkMsSUFBQUEsS0FBSyxFQUFFO0FBQTFCLEdBQWQsRUFBaURMLE9BQWpELENBQWI7QUFFQSxRQUFNTSxJQUFJLEdBQUcsTUFBTSxxQkFBRyxjQUFILEVBQW1CO0FBQUVDLElBQUFBLEdBQUcsRUFBRVIsR0FBUDtBQUFZUyxJQUFBQSxJQUFJLEVBQUU7QUFBbEIsR0FBbkIsQ0FBbkI7QUFDQSxNQUFJLENBQUNGLElBQUwsRUFBVyxNQUFNRyxLQUFLLENBQUUsMkJBQUYsQ0FBWDtBQUVYLFFBQU1DLEdBQUcsR0FBRyxNQUFNQyxpQkFBR0MsUUFBSCxDQUFZTixJQUFaLEVBQWtCTyxLQUFsQixDQUF3QkMsaUJBQXhCLENBQWxCO0FBRUEsTUFBSWIsSUFBSSxDQUFDRyxTQUFULEVBQW9CLG1DQUFVTSxHQUFWO0FBRXBCLE1BQUlULElBQUksQ0FBQ0ksS0FBTCxJQUFjSyxHQUFHLENBQUNLLElBQWxCLElBQTBCTCxHQUFHLENBQUNLLElBQUosQ0FBU0MsTUFBdkMsRUFBK0NDLE9BQU8sQ0FBQ1osS0FBUixHQUFnQkssR0FBRyxDQUFDSyxJQUFwQjtBQUUvQyxTQUFPTCxHQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdXAgZnJvbSAnZmluZC11cCc7XG5pbXBvcnQgZnMgZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IG5vcm1hbGl6ZSwgeyBQYWNrYWdlIH0gZnJvbSAnbm9ybWFsaXplLXBhY2thZ2UtZGF0YSc7XG5pbXBvcnQgeyByZWplY3RzIH0gZnJvbSAnZXJyb3Jpc2gnO1xuXG5leHBvcnQgaW50ZXJmYWNlIElMb2FkUGFja2FnZU9wdHMge1xuICAvKipcbiAgICogTm9ybWFsaXplcyB0aGUgYHBhY2thZ2UuanNvbmAgZGF0YS4gW1NlZSBub3JtYWxpemF0aW9uIGRldGFpbHMuXShodHRwczovL3d3dy5ucG1qcy5jb20vcGFja2FnZS9ub3JtYWxpemUtcGFja2FnZS1kYXRhI3doYXQtbm9ybWFsaXphdGlvbi1jdXJyZW50bHktZW50YWlscykgRGVmYXVsdDogYHRydWVgLlxuICAgKi9cbiAgbm9ybWFsaXplPzogYm9vbGVhbjtcbiAgLyoqXG4gICAqIFNldHMgcHJvY2Vzcy50aXRsZSB0byB0aGUgcGFja2FnZSBuYW1lIC1pZiBhdmFpbGFibGUuIERlZmF1bHQ6IGBmYWxzZWAuXG4gICAqL1xuICB0aXRsZT86IGJvb2xlYW47XG59XG5cbi8qKlxuICogSXQgd2lsbCBmaW5kIGFuZCByZXR1cm4gdGhlIGNvbnRlbnRzIG9mIHRoZSBmaXJzdCBgcGFja2FnZS5qc29uYCBmb3VuZCwgcmVjdXJzaW5nIHVwLCBzdGFydGluZyBvbiBgZGlyYC4gSXQgY2FuIG9wdGlvbmFsbHkgbm9ybWFsaXplIHRoZSBkYXRhIGFuZCBzZXQgdGhlIGBwcm9jZXNzLnRpdGxlYCB0byB0aGUgcGFja2FnZSBuYW1lLlxuICovXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBsb2FkUGFja2FnZShcbiAgZGlyOiBzdHJpbmcsXG4gIG9wdGlvbnM/OiBJTG9hZFBhY2thZ2VPcHRzXG4pOiBQcm9taXNlPFBhY2thZ2U+IHtcbiAgY29uc3Qgb3B0cyA9IE9iamVjdC5hc3NpZ24oeyBub3JtYWxpemU6IHRydWUsIHRpdGxlOiBmYWxzZSB9LCBvcHRpb25zKTtcblxuICBjb25zdCBwYXRoID0gYXdhaXQgdXAoJ3BhY2thZ2UuanNvbicsIHsgY3dkOiBkaXIsIHR5cGU6ICdmaWxlJyB9KTtcbiAgaWYgKCFwYXRoKSB0aHJvdyBFcnJvcihgcGFja2FnZSBjb3VsZG4ndCBiZSBmb3VuZGApO1xuXG4gIGNvbnN0IHBrZyA9IGF3YWl0IGZzLnJlYWRKU09OKHBhdGgpLmNhdGNoKHJlamVjdHMpO1xuXG4gIGlmIChvcHRzLm5vcm1hbGl6ZSkgbm9ybWFsaXplKHBrZyk7XG5cbiAgaWYgKG9wdHMudGl0bGUgJiYgcGtnLm5hbWUgJiYgcGtnLm5hbWUubGVuZ3RoKSBwcm9jZXNzLnRpdGxlID0gcGtnLm5hbWU7XG5cbiAgcmV0dXJuIHBrZztcbn1cbiJdfQ==
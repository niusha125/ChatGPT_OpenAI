import { asNew, intercept, mark } from "../helpers/index.js";
import deferred from "../create/deferred.js";
export default deferrable;

function deferrable(promise, create) {
  const p = asNew(promise, create);
  if (mark.get(p, 'deferrable')) return p;
  mark.set(p, 'deferrable');
  const px = deferred();
  p.resolve = px.resolve;
  p.reject = px.reject;
  return intercept(p, py => {
    py.then(val => px.resolve(val)).catch(reason => px.reject(reason));
    return px;
  });
}
import intercept from "../helpers/intercept.js";
import isPromise from "../utils/is-promise.js";
export default lazy;

function lazy(executor) {
  const promise = new Promise(resolve => resolve());
  let p;
  return intercept(promise, () => {
    return p || (p = new Promise(executor));
  });
}

lazy.fn = function lazyFn(fn) {
  return lazy((resolve, reject) => {
    try {
      const res = fn();
      if (isPromise(res)) res.then(resolve).catch(reject);else resolve(res);
    } catch (err) {
      reject(err);
    }
  });
};